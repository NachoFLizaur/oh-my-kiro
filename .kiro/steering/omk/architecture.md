# Oh-My-Kiro — Architecture

## Overview
Oh-My-Kiro is a multi-agent orchestration system built on three main agents and five specialized subagents. The architecture separates planning from execution through disk-based plan files, enabling human oversight and structured workflows.

The system operates through three distinct interaction patterns:
- **Planning sessions** (Prometheus): Research and plan generation
- **Plan execution** (Atlas): Autonomous execution of existing plans
- **Direct tasks** (Sisyphus): Immediate task handling

## Main Agents

### Prometheus (The Planner)
**Role**: Interviews users, researches codebases, and generates detailed execution plans.

**When to use**: 
- Complex features requiring research and planning
- When you want structured, reviewable plans before execution
- Multi-step workflows that benefit from upfront analysis

**Key capabilities**:
- User requirement gathering through interactive interviews
- Codebase exploration via omk-explorer delegation
- Research delegation to omk-researcher for technical decisions
- Plan review and refinement via omk-metis
- Generates structured plan files at `.kiro/plans/{name}.md`

**Keyboard shortcut**: `Ctrl+P`

### Atlas (The Plan Executor)
**Role**: Reads existing plans from disk and autonomously executes them through subagent delegation.

**When to use**:
- Executing pre-written plans generated by Prometheus
- When you want autonomous execution with verification steps
- Structured workflows that require coordination between multiple subagents

**Key capabilities**:
- Reads and parses plan files from `.kiro/plans/`
- Delegates implementation tasks to omk-sisyphus-jr
- Coordinates code reviews via omk-reviewer
- Verifies completion and updates plan status
- **Never writes code directly** (restricted to `.kiro/` paths only)

**Keyboard shortcut**: `Ctrl+A`

### Sisyphus (The Direct Task Handler)
**Role**: Handles immediate user requests and direct task execution.

**When to use**:
- Quick fixes and immediate changes
- Direct implementation requests
- When you don't need structured planning
- Ad-hoc tasks and troubleshooting

**Key capabilities**:
- Full filesystem access for direct code changes
- Can delegate to any execution subagent as needed
- Handles both simple and complex requests immediately
- No plan file requirements

**Keyboard shortcut**: `Ctrl+E`

## Subagents

### omk-explorer
**Specialization**: Codebase exploration and analysis
- Maps project structure and dependencies
- Identifies relevant files for tasks
- Analyzes existing patterns and conventions
- **Write restriction**: `.kiro/notepads/**` only

### omk-metis
**Specialization**: Plan review and validation
- Reviews generated plans for completeness
- Identifies potential issues or gaps
- Suggests improvements and refinements
- **Write restriction**: `.kiro/notepads/**` only

### omk-researcher
**Specialization**: Technical research and recommendations
- Researches best practices and approaches
- Evaluates technical options and trade-offs
- Provides implementation recommendations
- **Write restriction**: `.kiro/notepads/**` only

### omk-reviewer
**Specialization**: Code review and quality assurance
- Reviews implemented code for quality
- Checks adherence to patterns and conventions
- Identifies bugs and improvement opportunities
- **Write restriction**: `.kiro/notepads/**` only

### omk-sisyphus-jr
**Specialization**: Code implementation and file operations
- Implements features and fixes based on specifications
- Creates, modifies, and deletes files as needed
- Handles complex multi-file changes
- **Write access**: Full filesystem access

## Delegation Flows

### Planning Flow (Prometheus)
```
User Request → Prometheus
    ├── omk-explorer (codebase analysis)
    ├── omk-researcher (technical research)
    └── omk-metis (plan review)
         ↓
    Plan File (.kiro/plans/{name}.md)
```

### Plan Execution Flow (Atlas)
```
Plan File → Atlas
    ├── omk-explorer (task-specific exploration)
    ├── omk-sisyphus-jr (implementation)
    └── omk-reviewer (code review)
         ↓
    Completed Implementation
```

### Direct Task Flow (Sisyphus)
```
User Request → Sisyphus
    └── Any execution subagent as needed
         ↓
    Immediate Implementation
```

## Architectural Patterns

### Notepad System
Cross-subagent memory system at `.kiro/notepads/{plan-name}/` enables coordination between isolated subagents.

**Purpose**: Since subagents have isolated contexts, notepads provide shared filesystem locations for exchanging findings, decisions, and intermediate results.

**Key files**:
- `exploration.md` - Codebase findings (omk-explorer)
- `research.md` - Technical research (omk-researcher)  
- `review.md` - Review notes (omk-metis, omk-reviewer)
- `decisions.md` - Key decisions (main agents)
- `progress.md` - Execution progress (main agents)

**Rules**:
- Subagents append to files, never overwrite
- Main agents create notepad directories before delegation
- Cleaned up when plan status reaches COMPLETE

### Write Restrictions
Filesystem access is carefully controlled to maintain system integrity:

**Main Agents (Prometheus, Atlas)**:
- Restricted to `.kiro/plans/**` and `.kiro/notepads/**`
- Cannot modify user code directly
- Ensures separation between planning and execution

**Research Subagents (explorer, metis, researcher, reviewer)**:
- Restricted to `.kiro/notepads/**` only
- Read-only access to user code
- Prevents accidental modifications during analysis

**Execution Subagents (sisyphus-jr)**:
- Full filesystem access
- Can create, modify, and delete any files
- Trusted with actual implementation

### Trusted Agents
Subagents are configured as `trustedAgents` in main agent configs, enabling:
- Autonomous operation without user confirmation
- Streamlined delegation workflows
- Reduced interaction overhead during execution

This trust model allows main agents to delegate complex tasks while maintaining control over the overall workflow.