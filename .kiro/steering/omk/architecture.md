# Oh-My-Kiro — Architecture

## Overview
Oh-My-Kiro is a multi-agent orchestration system built on three main agents and seven specialized subagents. The architecture separates planning from execution through disk-based plan files, enabling human oversight and structured workflows.

The system operates through three distinct interaction patterns:
- **Planning sessions** (Phantom): Research and plan generation
- **Plan execution** (Revenant): Autonomous execution of existing plans
- **Direct tasks** (Wraith): Immediate task handling

## Main Agents

### Phantom (The Planner)
**Role**: Interviews users, researches codebases, and generates detailed execution plans.

**When to use**: 
- Complex features requiring research and planning
- When you want structured, reviewable plans before execution
- Multi-step workflows that benefit from upfront analysis

**Key capabilities**:
- Pre-plan analysis via ghost-analyst (mandatory before every plan)
- User requirement gathering through interactive interviews
- Codebase exploration via ghost-explorer delegation
- Research delegation to ghost-researcher for technical decisions
- Optional high-accuracy plan validation via ghost-validator
- Generates structured plan files at `.kiro/plans/{name}.md`

**Keyboard shortcut**: `Ctrl+P`

### Revenant (The Plan Executor)
**Role**: Reads existing plans from disk and autonomously executes them through subagent delegation.

**When to use**:
- Executing pre-written plans generated by Phantom
- When you want autonomous execution with verification steps
- Structured workflows that require coordination between multiple subagents

**Key capabilities**:
- Reads and parses plan files from `.kiro/plans/`
- Delegates implementation tasks to ghost-implementer
- Coordinates code reviews via ghost-reviewer
- Strategic consultation via ghost-oracle for architecture advice and debugging escalation
- Verifies completion and updates plan status
- **Never writes code directly** (restricted to `.kiro/` paths only)

**Keyboard shortcut**: `Ctrl+A`

### Wraith (The Direct Task Handler)
**Role**: Handles immediate user requests and direct task execution.

**When to use**:
- Quick fixes and immediate changes
- Direct implementation requests
- When you don't need structured planning
- Ad-hoc tasks and troubleshooting

**Key capabilities**:
- Full filesystem access for direct code changes
- Can delegate to any execution subagent as needed
- Strategic consultation via ghost-oracle for debugging escalation and self-review
- Handles both simple and complex requests immediately
- No plan file requirements

**Keyboard shortcut**: `Ctrl+E`

## Subagents

### ghost-explorer
**Specialization**: Codebase exploration and analysis
- Maps project structure and dependencies
- Identifies relevant files for tasks
- Analyzes existing patterns and conventions
- **Write restriction**: `.kiro/notepads/**` only

### ghost-analyst
**Specialization**: Pre-plan analysis and request assessment
- Analyzes user requests BEFORE plan generation
- Identifies hidden intentions, ambiguities, and risks
- Provides directives for plan generation
- Suggests acceptance criteria
- **Write restriction**: `.kiro/notepads/**` only

### ghost-validator
**Specialization**: Post-plan validation
- Reviews completed plans for blocking issues
- Defaults to APPROVE — only rejects for true blockers
- Limited to max 3 blocking issues per review
- Checks: file references, task feasibility, internal consistency
- **Write restriction**: `.kiro/notepads/**` only

### ghost-researcher
**Specialization**: Technical research and recommendations
- Researches best practices and approaches
- Evaluates technical options and trade-offs
- Provides implementation recommendations
- **Write restriction**: `.kiro/notepads/**` only

### ghost-reviewer
**Specialization**: Code review and quality assurance
- Reviews implemented code for quality
- Checks adherence to patterns and conventions
- Identifies bugs and improvement opportunities
- **Write restriction**: `.kiro/notepads/**` only

### ghost-implementer
**Specialization**: Code implementation and file operations
- Implements features and fixes based on specifications
- Creates, modifies, and deletes files as needed
- Handles complex multi-file changes
- **Write access**: Full filesystem access

### ghost-oracle
**Specialization**: Strategic advisory (read-only)
- Provides architecture advice with pragmatic minimalism
- Debugging escalation after repeated failures
- Self-review of completed work
- Presents ONE recommendation with effort estimate
- **Write restriction**: `.kiro/notepads/**` only
- **No delegation**: Cannot spawn other subagents

## Delegation Flows

### Planning Flow (Phantom)
```
User Request → Phantom
    ├── ghost-analyst (pre-plan analysis) ← MANDATORY
    ├── ghost-explorer (codebase analysis)
    ├── ghost-researcher (technical research)
    └── ghost-validator (plan validation) ← OPTIONAL
         ↓
    Plan File (.kiro/plans/{name}.md)
```

### Plan Execution Flow (Revenant)
```
Plan File → Revenant
    ├── ghost-explorer (task-specific exploration)
    ├── ghost-implementer (implementation)
    ├── ghost-reviewer (code review)
    └── ghost-oracle (strategic advice) ← NEW
         ↓
    Completed Implementation
```

### Direct Task Flow (Wraith)
```
User Request → Wraith
    ├── Any execution subagent as needed
    └── ghost-oracle (strategic advice) ← NEW
         ↓
    Immediate Implementation
```

## Architectural Patterns

### Notepad System
Cross-subagent memory system at `.kiro/notepads/{plan-name}/` enables coordination between isolated subagents.

**Purpose**: Since subagents have isolated contexts, notepads provide shared filesystem locations for exchanging findings, decisions, and intermediate results.

**Key files**:
- `exploration.md` - Codebase findings (ghost-explorer)
- `research.md` - Technical research (ghost-researcher)  
- `review.md` - Review notes (ghost-analyst, ghost-reviewer)
- `decisions.md` - Key decisions (main agents)
- `progress.md` - Execution progress (main agents)

**Rules**:
- Subagents append to files, never overwrite
- Main agents create notepad directories before delegation
- Cleaned up when plan status reaches COMPLETE

### Write Restrictions
Filesystem access is carefully controlled to maintain system integrity:

**Main Agents (Phantom, Revenant)**:
- Restricted to `.kiro/plans/**` and `.kiro/notepads/**`
- Cannot modify user code directly
- Ensures separation between planning and execution

**Research/Advisory Subagents (explorer, analyst, validator, researcher, reviewer, oracle)**:
- Restricted to `.kiro/notepads/**` only
- Read-only access to user code
- Prevents accidental modifications during analysis

**Execution Subagents (implementer)**:
- Full filesystem access
- Can create, modify, and delete any files
- Trusted with actual implementation

### Oracle Consultation Pattern
Strategic advisory system available to Revenant and Wraith (not Phantom) for three use cases:

**Architecture Advice**: When facing design decisions during execution, consult Oracle for a single, effort-tagged recommendation biased toward simplicity.

**Debugging Escalation**: After 2+ failed attempts at a task, consult Oracle for a fresh perspective and alternative approach before the final attempt.

**Self-Review**: After completing significant work, consult Oracle for an advisory assessment of the approach taken.

**Key constraints**:
- Oracle is read-only (notepads only)
- Oracle cannot delegate to other subagents
- Oracle presents ONE recommendation, not menus
- Oracle tags all recommendations with effort estimates (S/M/L)

### Trusted Agents
Subagents are configured as `trustedAgents` in main agent configs, enabling:
- Autonomous operation without user confirmation
- Streamlined delegation workflows
- Reduced interaction overhead during execution

**Trusted agent assignments**:
- Phantom: 4 trusted (explorer, researcher, analyst, validator)
- Revenant: 4 trusted (explorer, implementer, reviewer, oracle)
- Wraith: 4 trusted (explorer, implementer, reviewer, oracle)

This trust model allows main agents to delegate complex tasks while maintaining control over the overall workflow.